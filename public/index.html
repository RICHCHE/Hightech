<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Busy Dinosaur</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-dark text-white">
    <div class="container mt-5">
        <h1 class="text-center mb-4 title">The Busy Dinosaur</h1>

        <form id="document-form" class="mb-4 bg-save p-4 shadow-sm rounded">
            <div class="form-group">
                <input type="hidden" id="document-id">
                <input type="text" class="form-control bg-light text-dark rounded-pill" id="topic" placeholder="Topic" required>
            </div>
            <div class="form-group">
                <input type="text" class="form-control bg-light text-dark rounded-pill" id="writer" placeholder="Writer" required>
            </div>
            <div class="form-group">
                <textarea class="form-control bg-light text-dark rounded" id="content" placeholder="Content" required></textarea>
            </div>
            <button type="submit" class="btn btn-orange btn-block rounded-pill shadow-sm">Save Document</button>
        </form>

        <div class="card document-card bg-documents shadow-lg">
            <div class="card-header text-warning text-center">
                <h2 class="mb-0">Dinosaur Documents</h2>
            </div>
            <div class="card-body p-4">
                <ul id="document-list" class="list-group list-group-flush"></ul>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('document-form');
        const documentList = document.getElementById('document-list');
        const documentIdField = document.getElementById('document-id');
        const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000' : 'https://hightech-xi.vercel.app';

        async function fetchDocuments() {
            try {
                const response = await fetch(`${API_URL}/documents`);
                const documents = await response.json();
                console.log(documents); 
                documentList.innerHTML = documents.map(doc => `
                    <li class="list-group-item d-flex justify-content-between align-items-center bg-dark text-light">
                        <div>
                            <strong>${doc.topic}</strong> by ${doc.writer}
                        </div>
                        <div>
                            <button class="btn btn-warning btn-sm" onclick="editDocument('${doc._id}', '${doc.topic}', '${doc.writer}', '${doc.content}')">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteDocument('${doc._id}')">Delete</button>
                            <a href="${API_URL}/documents/download/${doc._id}" class="btn btn-success btn-sm">Download</a>
                        </div>
                    </li>
                `).join('');
            } catch (error) {
                console.error('Error fetching documents:', error);
            }
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const topic = document.getElementById('topic').value;
            const writer = document.getElementById('writer').value;
            const content = document.getElementById('content').value;
            const documentId = documentIdField.value;

            const url = documentId ? `${API_URL}/documents/${documentId}` : `${API_URL}/documents`;
            const method = documentId ? 'PUT' : 'POST';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ topic, writer, content }),
                });

                if (response.ok) {
                    form.reset();
                    documentIdField.value = '';
                    fetchDocuments(); 
                } else {
                    const data = await response.json();
                    console.error('Error:', data.message);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });

        function editDocument(id, topic, writer, content) {
            document.getElementById('topic').value = topic;
            document.getElementById('writer').value = writer;
            document.getElementById('content').value = content;
            documentIdField.value = id;
        }

        async function deleteDocument(id) {
            await fetch(`${API_URL}/documents/${id}`, { method: 'DELETE' });
            fetchDocuments(); 
        }

        document.addEventListener("DOMContentLoaded", fetchDocuments); 
    </script>
</body>
</html>

